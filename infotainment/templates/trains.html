<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tampere Train Arrivals & Departures</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .loading {
            text-align: center;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>ðŸš† Helsinki Train Arrivals & Departures</h1>
    <div class="loading" id="loading">Loading...</div>
    <table id="train-table">
        <thead>
            <tr>
                <th>Train</th>
                <th>Type</th>
                <th>Arrival</th>
                <th>Departure</th>
                <th>Destination</th>
            </tr>
        </thead>
        <tbody>
            <!-- Train rows will go here -->
        </tbody>
    </table>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetchTrainData();
        });

        async function fetchTrainData() {
            try {
                const response = await fetch("https://rata.digitraffic.fi/api/v1/live-trains/station/TPE?minutes_before_departure=60&minutes_after_departure=60&minutes_before_arrival=60&minutes_after_arrival=60");
                const data = await response.json();
                const trainTableBody = document.querySelector('#train-table tbody');
                const loadingElement = document.getElementById('loading');
                
                // Clear loading message
                loadingElement.style.display = 'none';

                // Loop through the train data and populate the table
                data.forEach(train => {
                    const row = document.createElement('tr');

                    const trainCell = document.createElement('td');
                    trainCell.textContent = train.trainNumber;
                    row.appendChild(trainCell);

                    const typeCell = document.createElement('td');
                    typeCell.textContent = train.trainCategory;
                    row.appendChild(typeCell);

                    const arrivalCell = document.createElement('td');
                    arrivalCell.textContent = getTrainTime(train, 'ARRIVAL');
                    row.appendChild(arrivalCell);

                    const departureCell = document.createElement('td');
                    departureCell.textContent = getTrainTime(train, 'DEPARTURE');
                    row.appendChild(departureCell);

                    const destinationCell = document.createElement('td');
                    destinationCell.textContent = train.timeTableRows[train.timeTableRows.length - 1]?.stationShortCode;
                    row.appendChild(destinationCell);

                    trainTableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Error fetching train data:", error);
            }
        }

        function getTrainTime(train, type) {
            const timeRow = train.timeTableRows.find(row => row.stationShortCode === "TPE" && row.type === type);
            return timeRow ? timeRow.scheduledTime : "-";
        }
    </script>
</body>
</html>
